# Claude Development Guidelines

This file documents the guidelines I follow while working on this project.

## Documentation Commitment

### 1. API Documentation (`docs.md`)
- **When**: Updated after every meaningful API change
- **What**: Public interfaces, CLI commands, configuration, service methods
- **Format**: Markdown with examples and clear parameter descriptions

### 2. Changelog Tracking
- API additions/changes are immediately reflected in `docs.md`
- Major breaking changes are flagged clearly
- New features include usage examples

### 3. Code Organization
- All new modules are documented with docstrings
- Public functions include type hints and docstrings
- Complex logic includes inline comments explaining the "why"

## Development Process

### Before Writing Code
1. Check existing patterns in the codebase
2. Consider the stage deliverables
3. Plan multi-step tasks with TodoWrite

### While Writing Code
1. Prefer editing existing files over creating new ones
2. Keep solutions focused and simple (avoid over-engineering)
3. Only add what's needed for the current task
4. Write defensive code at system boundaries (user input, external APIs)

### After Completing Features
1. Update `docs.md` with new APIs/commands
2. Update `stages/stage_1.md` checklist
3. Test the feature with provided examples
4. Commit with clear message describing changes

## Testing Guidelines

### CLI Testing
- Use `--help` to verify command structure
- Use `--verbose` to debug issues
- Test with real repository paths
- Document common issues and solutions in `docs.md`

### Manual Verification
- Test each new command after implementation
- Verify error handling works gracefully
- Check that configuration is read correctly

## When to Escalate
- If OpenCode API changes, update service wrapper
- If configuration structure changes, update Settings class
- If CLI commands change, update help text and docs
- If dependencies are added, update `pyproject.toml` and mention in docs

## Change Log

### 2025-01-17 - Git URL Support Added

**Major Feature: Git URL Support**
- Created `repository_loader.py` module with full Git clone support
- CLI now accepts Git URLs in addition to local paths
- Repositories automatically cloned to `./tmp/owner/repo` structure
- Added `--force-clone` flag to re-clone existing repositories
- Supports HTTPS, SSH, and Git protocol URLs
- Existing clones are automatically reused (no unnecessary re-cloning)

**API Changes**
- `repo-explain analyze` now accepts `[REPO_PATH_OR_URL]` instead of just `[REPO_PATH]`
- Added `--force-clone` option
- New `RepositoryLoader` class with methods:
  - `load(path_or_url, force_clone)` - Main entry point
  - `is_git_url(path_or_url)` - Detects Git URLs
  - `parse_git_url(git_url)` - Extracts owner/repo
  - `clone_repository(git_url, force)` - Clones repo
  - `cleanup(owner, repo)` - Removes clones

**Documentation Updated**
- Added extensive Git URL examples to `docs.md`
- Documented RepositoryLoader service API
- Added Git clone troubleshooting section
- Added validation tests for Git URLs
- Updated all examples to show both local and remote usage

**Testing**
- Verified with real GitHub repository (octocat/Hello-World)
- Confirmed clone to correct path (./tmp/octocat/Hello-World)
- Verified clone reuse on subsequent runs
- Tested --force-clone flag successfully

---

### 2025-01-17 - Initial Release

**Fixed OpenCode CLI Integration**
- Updated `opencode_service.py` to use correct CLI syntax: `opencode run <prompt> --format json`
- Removed incorrect `-p` and `-f` flags (OpenCode doesn't use those)
- Removed `--command` flag for custom commands (will implement `.opencode/commands/` structure next)
- Service now successfully invokes OpenCode and receives structured JSON output
- CLI tests pass: `repo-explain analyze . --depth quick --verbose` successfully runs

**Documentation Created**
- `docs.md` - Complete API documentation with examples
- `.claude.md` - This guidelines file for maintaining consistency
- Added API changes tracking section to docs.md

---

Last Updated: 2025-01-17 - Git URL support complete
